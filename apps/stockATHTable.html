<!DOCTYPE html>
<html>

<head>
    <title>Stock Prices</title>
</head>

<body>
    <h1>Stock Prices</h1>
    <table border="1">
        <tr>
            <th>Company Name</th>
            <th>Stock Ticker</th>
            <th>All Time High Price</th>
            <th>Current Price</th>
            <th>% To All Time High</th>
        </tr>
    </table>

    <script>
        const companies = [
            { name: 'Vanguard S&P500', ticker: 'VOO' },
            { name: 'Invesco QQQ', ticker: 'QQQ' },
            { name: 'Apple', ticker: 'AAPL' },
            { name: 'Microsoft', ticker: 'MSFT' },
            { name: 'Google', ticker: 'GOOG' },
            { name: 'Tesla', ticker: 'TSLA' },
            { name: 'Nvidia', ticker: 'NVDA' },
            { name: 'Amazon', ticker: 'AMZN' },
            { name: 'Facebook', ticker: 'META' },
            { name: 'Broadcom', ticker: 'AVGO' },
            { name: 'Taiwan Semiconductors', ticker: 'TSM' },
            { name: 'AMD', ticker: 'AMD' },
            { name: 'JP Morgan', ticker: 'JPM' },
            { name: 'Bank Of America', ticker: 'BAC' },
            { name: 'Old Dominion Freight Line', ticker: 'ODFL' },
            { name: 'Costco', ticker: 'COST' },
            { name: 'United Health Group', ticker: 'UNH' },
            { name: 'NXP Semiconductors', ticker: 'NXPI' },
            { name: 'Texas Instruments', ticker: 'TXN' },
            { name: 'CrowdStrike', ticker: 'CRWD' },
            { name: 'Synchrony', ticker: 'SYF' },
            { name: 'Coinbase', ticker: 'COIN' },
            { name: 'Paypal', ticker: 'PYPL' },
            { name: 'Intel', ticker: 'INTC' },
            { name: 'Palantir', ticker: 'PLTR' },
            { name: 'Datadog', ticker: 'DDOG' },
            { name: 'Baidu', ticker: 'BIDU' },
            { name: 'Alibaba', ticker: 'BABA' },
            { name: 'Xpeng', ticker: 'XPEV' },
            { name: 'Riot Platforms', ticker: 'RIOT' },
            { name: 'Nio', ticker: 'NIO' },
            { name: 'Marathon Digital', ticker: 'MARA' },
            { name: 'Rivian', ticker: 'RIVN' },
            { name: 'Bit Digital', ticker: 'BTBT' },
        ];

        async function fetchData() {
            const apiKey = 'cka8ta1r01qpia5h1cogcka8ta1r01qpia5h1cp0';
            const table = document.querySelector('table');

            for (const company of companies) {
                // Get ticker
                const ticker = company.ticker.toUpperCase();

                // Get highest price
                const historicalData = await fetch(`https://finnhub.io/api/v1/stock/candle?symbol=${ticker}&resolution=M&from=${getDateOfTheNumberOfYearsAgoFromToday(10)}&to=${getCurrentDate()}&token=${apiKey}`);
                const historicalDataJson = await historicalData.json();
                const highestPrice = Math.max(...historicalDataJson.h);

                // Get current price 
                const currentData = await fetch(`https://finnhub.io/api/v1/quote?symbol=${ticker}&token=${apiKey}`);
                const currentDataJson = await currentData.json();
                const currentPrice = currentDataJson.c;

                // Calculate % To ATH
                const percentageToAllTimeHigh = ((highestPrice - currentPrice) / currentPrice) * 100;

                const row = table.insertRow(-1);
                const cell1 = row.insertCell(0);
                const cell2 = row.insertCell(1);
                const cell3 = row.insertCell(2);
                const cell4 = row.insertCell(3);
                const cell5 = row.insertCell(4);

                cell1.innerHTML = company.name;
                cell2.innerHTML = company.ticker;
                cell3.innerHTML = highestPrice.toFixed(2);
                cell4.innerHTML = currentPrice.toFixed(2);
                cell5.innerHTML = percentageToAllTimeHigh.toFixed(2) + '%';
                
                // Wait
                await delay(1500);
            }
        }

        // Function to get the date of the number years ago from today.
        function getDateOfTheNumberOfYearsAgoFromToday(yearsAgo) {
            const currentDate = new Date();
            currentDate.setFullYear(currentDate.getFullYear() - yearsAgo);
            return Math.floor(currentDate / 1000); // Convert to Unix timestamp
        }

        // Function to get the current date in Unix timestamp
        function getCurrentDate() {
            return Math.floor(Date.now() / 1000); // Convert to Unix timestamp
        }

        // Function to wait for a certain amount of time
        function delay(milliseconds) {
            return new Promise(resolve => {
                setTimeout(resolve, milliseconds);
            });
        }

        fetchData();
    </script>
</body>

</html>